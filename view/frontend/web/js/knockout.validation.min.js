!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],e):e(ko,ko.validation={})}(function(e,t){if(void 0===e)throw new Error("Knockout is required, please ensure it is loaded before loading this validation plug-in");e.validation=t;var r,i,a=e.validation,n=e.utils,s=n.unwrapObservable,u=n.arrayForEach,l=n.extend,o={registerExtenders:!0,messagesOnModified:!0,errorsAsTitle:!0,errorsAsTitleOnModified:!1,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,decorateInputElement:!1,decorateElementOnModified:!0,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",allowHtmlMessages:!1,grouping:{deep:!1,observable:!0,live:!1},validate:{}},d=l({},o);d.html5Attributes=["required","pattern","min","max","step"],d.html5InputTypes=["email","number","date"],d.reset=function(){l(d,o)},a.configuration=d,a.utils=(r=(new Date).getTime(),i={},{isArray:function(e){return e.isArray||"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return null!==e&&"object"==typeof e},isNumber:function(e){return!isNaN(e)},isObservableArray:function(e){return!!e&&"function"==typeof e.remove&&"function"==typeof e.removeAll&&"function"==typeof e.destroy&&"function"==typeof e.destroyAll&&"function"==typeof e.indexOf&&"function"==typeof e.replace},values:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t},getValue:function(e){return"function"==typeof e?e():e},hasAttribute:function(e,t){return null!==e.getAttribute(t)},getAttribute:function(e,t){return e.getAttribute(t)},setAttribute:function(e,t,r){return e.setAttribute(t,r)},isValidatable:function(e){return!!(e&&e.rules&&e.isValid&&e.isModified)},insertAfter:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},newId:function(){return r+=1},getConfigOptions:function(e){return a.utils.contextFor(e)||a.configuration},setDomData:function(e,t){var r=e.__ko_validation__;r||(e.__ko_validation__=r=a.utils.newId()),i[r]=t},getDomData:function(e){var t=e.__ko_validation__;if(t)return i[t]},contextFor:function(e){switch(e.nodeType){case 1:case 8:var t=a.utils.getDomData(e);if(t)return t;if(e.parentNode)return a.utils.contextFor(e.parentNode)}},isEmptyVal:function(e){return null==e||""===e},getOriginalElementTitle:function(e){var t=a.utils.getAttribute(e,"data-orig-title"),r=e.title;return a.utils.hasAttribute(e,"data-orig-title")?t:r},async:function(e){window.setImmediate?window.setImmediate(e):window.setTimeout(e,0)},forEach:function(e,t){if(a.utils.isArray(e))return u(e,t);for(var r in e)e.hasOwnProperty(r)&&t(e[r],r)}});var f=function(){var t=0,r=a.configuration,i=a.utils;function o(e){u(e.subscriptions,function(e){e.dispose()}),e.subscriptions=[]}function d(t,r){r.validatables=[],o(r),function t(r,a,n){var s=[],u=r.peek?r.peek():r;!0!==r.__kv_traversed&&(a.options.deep&&(r.__kv_traversed=!0,a.flagged.push(r)),n=void 0!==n?n:a.options.deep?1:-1,e.isObservable(r)&&(r.errors||i.isValidatable(r)||r.extend({validatable:!0}),a.validatables.push(r),a.options.live&&i.isObservableArray(r)&&a.subscriptions.push(r.subscribe(function(){a.graphMonitor.valueHasMutated()}))),u&&!u._destroy&&(i.isArray(u)?s=u:i.isObject(u)&&(s=i.values(u))),0!==n&&i.forEach(s,function(r){!r||r.nodeType||e.isComputed(r)&&!r.rules||t(r,a,n+1)}))}(t,r),function(e){e.options.deep&&(u(e.flagged,function(e){delete e.__kv_traversed}),e.flagged.length=0),e.options.live||o(e)}(r)}function f(e){var t=[];return u(e,function(e){i.isValidatable(e)&&!e.isValid()&&t.push(e.error.peek())}),t}return{init:function(e,i){t>0&&!i||((e=e||{}).errorElementClass=e.errorElementClass||e.errorClass||r.errorElementClass,e.errorMessageClass=e.errorMessageClass||e.errorClass||r.errorMessageClass,l(r,e),r.registerExtenders&&a.registerExtenders(),t=1)},reset:a.configuration.reset,group:function(t,a){var s={options:a=l(l({},r.grouping),a),graphMonitor:e.observable(),flagged:[],subscriptions:[],validatables:[]},o=null;return(o=a.observable?e.computed(function(){return s.graphMonitor(),d(t,s),f(s.validatables)}):function(){return d(t,s),f(s.validatables)}).showAllMessages=function(e){void 0===e&&(e=!0),o.forEach(function(t){i.isValidatable(t)&&t.isModified(e)})},o.isAnyMessageShown=function(){return!!o.find(function(e){return i.isValidatable(e)&&!e.isValid()&&e.isModified()})},o.filter=function(e){return e=e||function(){return!0},o(),n.arrayFilter(s.validatables,e)},o.find=function(e){return e=e||function(){return!0},o(),n.arrayFirst(s.validatables,e)},o.forEach=function(e){e=e||function(){},o(),u(s.validatables,e)},o.map=function(e){return e=e||function(e){return e},o(),n.arrayMap(s.validatables,e)},o._updateState=function(e){if(!i.isObject(e))throw new Error("An object is required.");if(t=e,!a.observable)return d(e,s),f(s.validatables);s.graphMonitor.valueHasMutated()},o},formatMessage:function(e,t,r){if(i.isObject(t)&&t.typeAttr&&(t=t.value),"function"==typeof e)return e(t,r);var a=s(t);return null==a&&(a=[]),i.isArray(a)||(a=[a]),e.replace(/{(\d+)}/gi,function(e,t){return void 0!==a[t]?a[t]:e})},addRule:function(e,t){return"function"!=typeof e?e:(e.extend({validatable:!0}),!!n.arrayFirst(e.rules(),function(e){return e.rule&&e.rule===t.rule})||e.rules.push(t),e)},addAnonymousRule:function(e,t){void 0===t.message&&(t.message="Error"),t.onlyIf&&(t.condition=t.onlyIf),a.addRule(e,t)},addExtender:function(t){e.extenders[t]=function(e,r){return r&&(r.message||r.onlyIf)?a.addRule(e,{rule:t,message:r.message,params:!!i.isEmptyVal(r.params)||r.params,condition:r.onlyIf}):a.addRule(e,{rule:t,params:r})}},registerExtenders:function(){if(r.registerExtenders)for(var t in a.rules)a.rules.hasOwnProperty(t)&&(e.extenders[t]||a.addExtender(t))},insertValidationMessage:function(e){var t=document.createElement("SPAN");return t.className=i.getConfigOptions(e).errorMessageClass,i.insertAfter(e,t),t},parseInputValidationAttributes:function(e,t){u(a.configuration.html5Attributes,function(r){if(i.hasAttribute(e,r)){var n=e.getAttribute(r)||!0;if("min"===r||"max"===r){var s=e.getAttribute("type");void 0!==s&&s||(s="text"),n={typeAttr:s,value:n}}a.addRule(t(),{rule:r,params:n})}});var r=e.getAttribute("type");u(a.configuration.html5InputTypes,function(e){e===r&&a.addRule(t(),{rule:"date"===e?"dateISO":e,params:!0})})},writeInputValidationAttributes:function(t,r){var i=r();if(i&&i.rules){var s=i.rules();u(a.configuration.html5Attributes,function(r){var i=n.arrayFirst(s,function(e){return e.rule&&e.rule.toLowerCase()===r.toLowerCase()});i&&e.computed({read:function(){var a=e.unwrap(i.params);"pattern"===i.rule&&a instanceof RegExp&&(a=a.source),t.setAttribute(r,a)},disposeWhenNodeIsRemoved:t})}),s=null}},makeBindingHandlerValidatable:function(t){var r=e.bindingHandlers[t].init;e.bindingHandlers[t].init=function(t,i,a,n,s){return r(t,i,a,n,s),e.bindingHandlers.validationCore.init(t,i,a,n,s)}},setRules:function(t,r){var n=function(t,r){if(t&&r)for(var u in r)if(r.hasOwnProperty(u)){var l=r[u];if(t[u]){var o=t[u],d=s(o),f={},c={};for(var p in l)l.hasOwnProperty(p)&&(a.rules[p]?f[p]=l[p]:c[p]=l[p]);if(e.isObservable(o)&&o.extend(f),d&&i.isArray(d))for(var v=0;v<d.length;v++)n(d[v],c);else n(d,c)}}};n(t,r)}}}();function c(e){var t="max"===e;return function(r,i){if(a.utils.isEmptyVal(r))return!0;var n,s,u,l,o;switch(void 0===i.typeAttr?(s="text",n=i):(s=i.typeAttr,n=i.value),isNaN(n)||n instanceof Date||(s="number"),s.toLowerCase()){case"week":if(u=/^(\d{4})-W(\d{2})$/,null===(l=r.match(u)))throw new Error("Invalid value for "+e+" attribute for week input.  Should look like '2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min");return!!(o=n.match(u))&&(t?l[1]<o[1]||l[1]===o[1]&&l[2]<=o[2]:l[1]>o[1]||l[1]===o[1]&&l[2]>=o[2]);case"month":if(u=/^(\d{4})-(\d{2})$/,null===(l=r.match(u)))throw new Error("Invalid value for "+e+" attribute for month input.  Should look like '2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min");return!!(o=n.match(u))&&(t?l[1]<o[1]||l[1]===o[1]&&l[2]<=o[2]:l[1]>o[1]||l[1]===o[1]&&l[2]>=o[2]);case"number":case"range":return t?!isNaN(r)&&parseFloat(r)<=parseFloat(n):!isNaN(r)&&parseFloat(r)>=parseFloat(n);default:return t?r<=n:r>=n}}}function p(e,t,r){return!!t.validator(e(),void 0===r.params||s(r.params))||(e.setError(a.formatMessage(r.message||t.message,s(r.params),e)),!1)}function v(e,t,r){e.isValidating(!0);var i=function(i){var n=!1,u="";e.__valid__()?(i.message?(n=i.isValid,u=i.message):n=i,n||(e.error(a.formatMessage(u||r.message||t.message,s(r.params),e)),e.__valid__(n)),e.isValidating(!1)):e.isValidating(!1)};a.utils.async(function(){t.validator(e(),void 0===r.params||s(r.params),i)})}l(e.validation,f),a.rules={},a.rules.required={validator:function(e,t){var r;return null==e?!t:(r=e,"string"==typeof e&&(r=String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")),!t||(r+"").length>0)},message:"This field is required."},a.rules.min={validator:c("min"),message:"Please enter a value greater than or equal to {0}."},a.rules.max={validator:c("max"),message:"Please enter a value less than or equal to {0}."},a.rules.minLength={validator:function(e,t){return!!a.utils.isEmptyVal(e)||(a.utils.isNumber(e)?""+e:e).length>=t},message:"Please enter at least {0} characters."},a.rules.maxLength={validator:function(e,t){return!!a.utils.isEmptyVal(e)||(a.utils.isNumber(e)?""+e:e).length<=t},message:"Please enter no more than {0} characters."},a.rules.pattern={validator:function(e,t){return a.utils.isEmptyVal(e)||null!==e.toString().match(t)},message:"Please check this value."},a.rules.step={validator:function(e,t){if(a.utils.isEmptyVal(e)||"any"===t)return!0;var r=100*e%(100*t);return Math.abs(r)<1e-5||Math.abs(1-r)<1e-5},message:"The value must increment by {0}."},a.rules.email={validator:function(e,t){return!t||(a.utils.isEmptyVal(e)||t&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e))},message:"Please enter a proper email address."},a.rules.date={validator:function(e,t){return!t||(a.utils.isEmptyVal(e)||t&&!/Invalid|NaN/.test(new Date(e)))},message:"Please enter a proper date."},a.rules.dateISO={validator:function(e,t){return!t||(a.utils.isEmptyVal(e)||t&&/^\d{4}[-/](?:0?[1-9]|1[012])[-/](?:0?[1-9]|[12][0-9]|3[01])$/.test(e))},message:"Please enter a proper date."},a.rules.number={validator:function(e,t){return!t||(a.utils.isEmptyVal(e)||t&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e))},message:"Please enter a number."},a.rules.digit={validator:function(e,t){return!t||(a.utils.isEmptyVal(e)||t&&/^\d+$/.test(e))},message:"Please enter a digit."},a.rules.phoneUS={validator:function(e,t){return!t||(!!a.utils.isEmptyVal(e)||"string"==typeof e&&(e=e.replace(/\s+/g,""),t&&e.length>9&&e.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)))},message:"Please specify a valid phone number."},a.rules.equal={validator:function(e,t){var r=t;return e===a.utils.getValue(r)},message:"Values must equal."},a.rules.notEqual={validator:function(e,t){var r=t;return e!==a.utils.getValue(r)},message:"Please choose another value."},a.rules.unique={validator:function(e,t){var r=a.utils.getValue(t.collection),i=a.utils.getValue(t.externalValue),s=0;return!e||!r||(n.arrayFilter(r,function(r){e===(t.valueAccessor?t.valueAccessor(r):r)&&s++}),s<(i?1:2))},message:"Please make sure the value is unique."},a.registerExtenders(),e.bindingHandlers.validationCore={init:function(t,r,i,n,s){var u=a.utils.getConfigOptions(t),l=r();if(u.parseInputAttributes&&a.utils.async(function(){a.parseInputValidationAttributes(t,r)}),u.insertMessages&&a.utils.isValidatable(l)){var o=a.insertValidationMessage(t);u.messageTemplate?e.renderTemplate(u.messageTemplate,{field:l},null,o,"replaceNode"):e.applyBindingsToNode(o,{validationMessage:l})}u.writeInputAttributes&&a.utils.isValidatable(l)&&a.writeInputValidationAttributes(t,r),u.decorateInputElement&&a.utils.isValidatable(l)&&e.applyBindingsToNode(t,{validationElement:l})}},a.makeBindingHandlerValidatable("value"),a.makeBindingHandlerValidatable("checked"),e.bindingHandlers.textInput&&a.makeBindingHandlerValidatable("textInput"),a.makeBindingHandlerValidatable("selectedOptions"),e.bindingHandlers.validationMessage={update:function(t,r){var i,u,l=r(),o=a.utils.getConfigOptions(t);s(l);if(null==l)throw new Error("Cannot bind validationMessage to undefined value. data-bind expression: "+t.getAttribute("data-bind"));i=l.isModified&&l.isModified(),u=l.isValid&&l.isValid();var d=null;o.messagesOnModified&&!i||(d=u?null:l.error);var f=!(o.messagesOnModified&&!i)&&!u,c="none"!==t.style.display;o.allowHtmlMessages?n.setHtml(t,d):e.bindingHandlers.text.update(t,function(){return d}),c&&!f?t.style.display="none":!c&&f&&(t.style.display="")}},e.bindingHandlers.validationElement={update:function(t,r,i){var n,u,l=r(),o=a.utils.getConfigOptions(t);s(l);if(null==l)throw new Error("Cannot bind validationElement to undefined value. data-bind expression: "+t.getAttribute("data-bind"));n=l.isModified&&l.isModified(),u=l.isValid&&l.isValid();e.bindingHandlers.css.update(t,function(){var e={},t=!(o.decorateElementOnModified&&!n||u);return e[o.errorElementClass]=t,e},i),o.errorsAsTitle&&e.bindingHandlers.attr.update(t,function(){var e=!o.errorsAsTitleOnModified||n,r=a.utils.getOriginalElementTitle(t);return e&&!u?{title:l.error,"data-orig-title":r}:!e||u?{title:r,"data-orig-title":null}:void 0})}},e.bindingHandlers.validationOptions={init:function(e,t,r,i,n){var u=s(t());if(u){var o=l({},a.configuration);l(o,u),a.utils.setDomData(e,o)}}},e.extenders.validation=function(e,t){return u(a.utils.isArray(t)?t:[t],function(t){a.addAnonymousRule(e,t)}),e},e.extenders.validatable=function(t,r){if(a.utils.isObject(r)||(r={enable:r}),"enable"in r||(r.enable=!0),r.enable&&!a.utils.isValidatable(t)){var i=a.configuration.validate||{},n={throttleEvaluation:r.throttle||i.throttle};t.error=e.observable(null),t.rules=e.observableArray(),t.isValidating=e.observable(!1),t.__valid__=e.observable(!0),t.isModified=e.observable(!1),t.isValid=e.computed(t.__valid__),t.setError=function(e){var r=t.error.peek(),i=t.__valid__.peek();t.error(e),t.__valid__(!1),r===e||i||t.isValid.notifySubscribers()},t.clearError=function(){return t.error(null),t.__valid__(!0),t};var s=t.subscribe(function(){t.isModified(!0)}),u=e.computed(l({read:function(){t(),t.rules();return a.validateObservable(t),!0}},n));l(u,n),t._disposeValidation=function(){t.isValid.dispose(),t.rules.removeAll(),s.dispose(),u.dispose(),delete t.rules,delete t.error,delete t.isValid,delete t.isValidating,delete t.__valid__,delete t.isModified,delete t.setError,delete t.clearError,delete t._disposeValidation}}else!1===r.enable&&t._disposeValidation&&t._disposeValidation();return t},a.validateObservable=function(e){for(var t,r,i=0,n=e.rules(),s=n.length;i<s;i++)if(!(r=n[i]).condition||r.condition())if((t=r.rule?a.rules[r.rule]:r).async||r.async)v(e,t,r);else if(!p(e,t,r))return!1;return e.clearError(),!0};var g,m={};a.defineLocale=function(e,t){return e&&t?(m[e.toLowerCase()]=t,t):null},a.locale=function(e){if(e){if(e=e.toLowerCase(),!m.hasOwnProperty(e))throw new Error("Localization "+e+" has not been loaded.");a.localize(m[e]),g=e}return g},a.localize=function(e){var t=a.rules;for(var r in e)t.hasOwnProperty(r)&&(t[r].message=e[r])},function(){var e={},t=a.rules;for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r].message);a.defineLocale("en-us",e)}(),g="en-us",e.applyBindingsWithValidation=function(t,r,i){var n,s=document.body;r&&r.nodeType?(s=r,n=i):n=r,a.init(),n&&(n=l(l({},a.configuration),n),a.utils.setDomData(s,n)),e.applyBindings(t,s)};var b=e.applyBindings;e.applyBindings=function(){a.init(),b.apply(this,arguments)},e.validatedObservable=function(t,r){if(!r&&!a.utils.isObject(t))return e.observable(t).extend({validatable:!0});var i=e.observable(t);return i.errors=a.group(a.utils.isObject(t)?t:{},r),i.isValid=e.observable(0===i.errors().length),e.isObservable(i.errors)?i.errors.subscribe(function(e){i.isValid(0===e.length)}):e.computed(i.errors).subscribe(function(e){i.isValid(0===e.length)}),i.subscribe(function(e){a.utils.isObject(e)||(e={}),i.errors._updateState(e),i.isValid(0===i.errors().length)}),i}});